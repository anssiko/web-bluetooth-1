<!DOCTYPE html>
<html>
  <head>
    <title>Web Bluetooth</title>
    <meta charset='utf-8'>
    <script src='./respec-w3c-common.js'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus: "CG-DRAFT",
          shortName:  "web-bluetooth",
          editors: [
            { name: "See contributors on GitHub",
              url: "https://github.com/WebBluetoothCG/web-bluetooth/graphs/contributors"
            },
          ],
          edDraftURI:   "http://webbluetoothcg.github.io/web-bluetooth/",
          wg:           "Web Bluetooth Community Group",
          wgURI:        "https://www.w3.org/community/web-bluetooth/",
          wgPublicList: "public-web-bluetooth",
          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/72794/status",

          otherLinks: [{
            key: "Participate",
            data: [
              { value: "Join the W3C Community Group",
                href: "http://www.w3.org/community/web-bluetooth/",
              },
              { value: "File bugs and feature requests",
                href: "https://github.com/WebBluetoothCG/web-bluetooth/issues",
              },
              { value: "Fix the text through GitHub",
                href: "https://github.com/WebBluetoothCG/web-bluetooth",
              },
              { value: "IRC: #web-bluetooth on W3C's IRC",
                href: "irc://irc.w3.org:6665/#web-bluetooth",
              },
              { value: "Public Mailing List",
                href: "http://lists.w3.org/Archives/Public/public-web-bluetooth/",
              },
            ],
          }],

          localBiblio: {
            "BLUETOOTH41": {
              href: "https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=282159",
              title: "BLUETOOTH SPECIFICATION Version 4.1",
              publisher: "Bluetooth SIG",
              date: "3 December 2013",
            },
            "BLUETOOTH-GATT-REST": {
              href: "https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=285910",
              title: "GATT REST API",
              publisher: "Bluetooth Internet WG",
              date: "7 April 2014",
            },
            "BLUETOOTH-ASSIGNED": {
              href: "https://www.bluetooth.org/en-us/specification/assigned-numbers",
              title: "Assigned Numbers",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-ASSIGNED-BASEBAND": {
              href: "https://www.bluetooth.org/en-us/specification/assigned-numbers/baseband",
              title: "Assigned Numbers for Baseband",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-NUMBERS-UNITS": {
              href: "https://developer.bluetooth.org/gatt/units/Pages/default.aspx",
              title: "Bluetooth GATT Specifications > Units",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-NUMBERS-SERVICES": {
              href: "https://developer.bluetooth.org/gatt/services/Pages/ServicesHome.aspx",
              title: "Bluetooth GATT Specifications > Services",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-NUMBERS-CHARACTERISTICS": {
              href: "https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicsHome.aspx",
              title: "Bluetooth GATT Specifications > Characteristics",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-NUMBERS-DESCRIPTORS": {
              href: "https://developer.bluetooth.org/gatt/descriptors/Pages/DescriptorsHomePage.aspx",
              title: "Bluetooth GATT Specifications > Descriptors",
              status: "Living Standard",
              publisher: "Bluetooth SIG",
            },
            "BLUETOOTH-SUPPLEMENT4": {
              href: "https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=282152",
              title: "Supplement to the Bluetooth Core Specification Version 4",
              date: "3 December 2013",
              publisher: "Bluetooth SIG",
            },
          },
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This document describes an API to discover and communicate with devices over the Bluetooth 4 wireless standard using the Generic Attribute Profile (GATT).
      </p>
    </section>

    <section id='sotd'>
      <p>
        Changes to this document may be tracked at <a href="https://github.com/WebBluetoothCG/web-bluetooth/commits/gh-pages">https://github.com/WebBluetoothCG/web-bluetooth/commits/gh-pages</a>.
      </p>
    </section>

    <section class='informative'>
      <h2>Introduction</h2>
      <p>
        <a href="https://developer.bluetooth.org/">Bluetooth</a> is
        a standard for short-range wireless communication between devices.
        Bluetooth "Classic" (<abbr title="Basic Rate">BR</abbr>/<abbr title="Enhanced Data Rate">EDR</abbr>)
        defines a set of binary protocols and supports speeds up to about 24Mbps.
        Bluetooth 4.0 introduced a new "Low Energy" mode known as "Smart",
        <abbr title="Bluetooth Low Energy">BTLE</abbr>, or just <abbr title="Low Energy">LE</abbr>
        which is limited to about 1Mbps but
        allows devices to leave their transmitters off most of the time.
        BTLE provides most of its functionality through key/value pairs provided by
        the <a title="Generic Attribute Profile">Generic Attribute Profile
        (<abbr title="Generic Attribute Profile">GATT</abbr>)</a>.

      <p>
        BTLE defines multiple roles that devices can play.
        The <dfn>Broadcaster</dfn> and <dfn>Observer</dfn> roles are
        for transmitter- and receiver-only applications, respectively.
        The <dfn>Peripheral</dfn> role is able to receive a single connection.
        The <dfn>Central</dfn> role supports multiple connections,
        and is responsible for creating any connections to <a>Peripheral</a> devices.

      <p>
        <dfn>GATT</dfn> further defines <dfn>Client</dfn> and <dfn>Server</dfn> roles,
        which are orthogonal to the <a>Peripheral</a> and <a>Central</a> BTLE roles.
        GATT allows <a>Server</a>s to expose <a>Service</a>s, whose type is identified by
        a UUID ([[!RFC4122]]).
        A <dfn>Service</dfn> exposes a collection of included Services and Characteristics.
        Each <dfn>Characteristic</dfn> has a type named by a UUID and
        exposes a value as an array of bytes,
        some properties to describe how the value can be used, and a collection of Descriptors.
        Each <dfn>Descriptor</dfn> has a type named by a UUID and
        contains related information about the Characteristic Value.

      <p>
        Despite being designed to support BTLE transport,
        the GATT protocol can also run over BR/EDR transport.
        Both support advertising GATT services without a connection:
        BTLE through advertising packets, and BR/EDR through the extended inquiry response.

      <p>
        The first version of this specification focuses on the Bluetooth 4 GATT protocol
        in the <a>Central</a> and <a>Client</a> roles, over either a BR/EDR or LE connection.
        While this specification cites the [[BLUETOOTH41]] specification,
        it intends to also support communication with devices that only implement Bluetooth 4.0.

    </section>

    <section>
      <h2>Security and privacy considerations</h2>

      <section>
        <h2>Device access is powerful</h2>

        <p>
          When a website requests access to devices using
          <code><a>BluetoothDiscovery.requestDevice</a>()</code>,
          it gets the ability to access all GATT services mentioned in the call.
          The UA MUST inform the user what capabilities these services give the website
          before asking which devices to entrust to it.
          If any services in the list aren't known to the UA,
          the UA MUST assume they give the site complete control over the device
          and inform the user of this risk.
          The UA MUST also allow the user to inspect what sites have access to what devices
          and revoke these pairings.

        <p>
          The UA MUST NOT allow the user to pair entire classes of devices with a website.
          It is possible to construct a class of devices
          for which each individual device sends the same Bluetooth-level identifying information.
          UAs are not required to attempt to detect this sort of forgery
          and MAY let a user pair this pseudo-device with a website.

        <p>
          To help ensure that only the entity the user approved for access actually has access,
          this specification requires that only
          <a href="https://w3c.github.io/webappsec/specs/mixedcontent/#authenticated-environment">authenticated environments</a>
          can access Bluetooth devices
          (<a href="#requestDevice-authenticated-environment">requestDevice</a>).
      </section>

      <section class="informative">
        <h2>Attacks on devices</h2>

        <p>
          We expect that many devices are vulnerable to unexpected data delivered to their radio.
          In the past, these devices had to be exploited one-by-one,
          but this API makes it plausible to conduct large-scale attacks.
          This specification takes several approaches to make such attacks more difficult:

        <ul>
          <li>
            Pairing individual devices instead of device classes
            requires at least a user action before a device can be exploited.

          <li>
            Constraining access to <a>GATT</a>, as opposed to generic byte-stream access,
            denies malicious websites access to most parsers on the device.

            <p>
              On the other hand,
              GATT's <a>Characteristic</a> and <a>Descriptor</a> values are still byte arrays,
              which may be set to lengths and formats the device doesn't expect.
              UAs are encouraged to validate these values when they can.

          <li>
            This API never exposes Bluetooth addressing, data signing or encryption keys ([[!BLUETOOTH41]] Volume 3 Part H Section 2.4.1) to websites.
            This makes it more difficult for a website to predict the bits that will be sent over the radio,
            which blocks <a href="https://www.usenix.org/legacy/events/woot11/tech/final_files/Goodspeed.pdf">packet-in-packet injection attacks</a>.
            Unfortunately, this only works over encrypted links,
            which not all BTLE devices are required to support.
        </ul>

        <p>
          UAs can also take further steps to protect their users:

        <ul>
          <li>
            A web service may collect lists of malicious websites and vulnerable devices.
            UAs can deny malicious websites access to any device
            and any website access to vulnerable devices.
        </ul>
      </section>

      <section class="informative">
        <h2>Bluetooth device identifiers</h2>

        <p>
          Each Bluetooth BR/EDR device has a unique 48-bit MAC address
          known as the <dfn>BD_ADDR</dfn> ([[!BLUETOOTH41]] 3.C.15).
          Each Bluetooth LE device has at least one of a <a>Public Device Address</a>
          and a <a>Static Random Address</a>.
          The <dfn>Public Device Address</dfn> is a MAC address ([[!BLUETOOTH41]] 6.B.1.3).
          The <dfn>Static Random Address</dfn> may be regenerated
          on each restart ([[!BLUETOOTH41]] 3.C.10.8).
          A BR/EDR/LE device will use the same value
          for the <a>BD_ADDR</a> and the <a>Public Device Address</a> ([[!BLUETOOTH41]] 2.E.7.4.6).

        <p>
          An LE device may also have a unique, 128-bit
          <dfn title="Identity Resolving Key">Identity Resolving Key
          (<abbr title="Identity Resolving Key">IRK</abbr>)</dfn>
          ([[!BLUETOOTH41]] 3.H.2.4.2.1),
          which is sent to trusted devices during the bonding process.
          To avoid leaking a persistent identifier, an LE device may scan and advertise using
          a random <dfn>Resolvable Private Address</dfn> or <dfn>Non-Resolvable Private Address</dfn>
          instead of its Static or Public Address.
          These are regenerated periodically (approximately every 15 minutes),
          but a bonded device can check whether one of its stored <a>IRK</a>s matches
          any given Resolvable Private Address ([[!BLUETOOTH41]] 3.C.10.8.2.3).

        <p>
          Each Bluetooth device also has a human-readable <dfn>Device Name</dfn>
          (([[!BLUETOOTH41]] 3.C.3.2.2).
          These aren't guaranteed to be unique, but may well be, depending on the device type.

        <section class="informative">
          <h2>Identifiers for remote Bluetooth devices</h2>

          <p>
            If a website can retrieve any of the persistent device IDs,
            these can be used, in combination with a large effort to catalog ambient devices,
            to discover a user's location.
            A device ID can also be used to identify that a user who
            pairs two different websites with the same Bluetooth device
            is a single user.
            On the other hand, many GATT services are available
            that could be used to fingerprint a device,
            and a device can easily expose a custom GATT service to make this easier.

          <p>
            Because it would be so easy to work around an attempt to block device identification,
            this spec doesn't try to do so.
        </section>

        <section class="informative">
          <h2>The UA's Bluetooth address</h2>

          <p>
            In BR/EDR mode, or in LE mode during active scanning without the <a>Privacy Feature</a>,
            the UA broadcasts its persistent ID to any nearby Bluetooth radio.
            This makes it easy to scatter hostile devices in an area and track the UA.
            As of 2014-08, few or no platforms document that they implement the <a>Privacy Feature</a>,
            so despite this spec recommending it, few UAs are likely to use it.
            This spec does <a href="#requestDevice-user-gesture">require a user gesture</a>
            for a website to trigger a scan, which reduces the frequency of scans some,
            but it would still be better for more platforms to expose the <a>Privacy Feature</a>.
        </section>
      </section>
    </section>

    <section>
      <h2>Device Discovery</h2>

      <p>
        The UA MUST maintain an <dfn>allowed devices list</dfn> for each origin,
        storing a set of Bluetooth devices the origin is allowed to access.
        For each device in the <a>allowed devices list</a> for an origin,
        the UA MUST maintain an <dfn>allowed services list</dfn> consisting of
        UUIDs for GATT Primary <a>Service</a>s the origin is allowed to access on the device.
        The UA MAY remove devices from the <a>allowed devices list</a> at any time
        based on signals from the user.
        For example, if the user chooses not to remember access,
        the UA might remove a device when the tab that was granted access to it is closed.
        Or the UA might provide a revocation UI that allows the user
        to explicitly remove a device even while a tab is actively using that device.
        If a device is removed from this list while
        a <a>Promise</a> is pending to do something with the device,
        it MUST be treated the same as if the device moved out of Bluetooth range.

      <pre class="idl">
        [NoInterfaceObject] interface BluetoothDiscovery {
          Promise&lt;BluetoothDevice> requestDevice(sequence&lt;BluetoothScanFilter> filters, optional RequestDeviceOptions options);
        };

        dictionary BluetoothScanFilter {
          sequence&lt;BluetoothServiceUuid> services;
        };

        dictionary RequestDeviceOptions {
          sequence&lt;BluetoothServiceUuid> optionalServices = [];
        };
      </pre>

      <p>
        <dfn>BluetoothScanFilter.services</dfn> is a list of <a>Service</a> UUIDs that a device must support to match this filter.
      </p>

      <p>
        <dfn>RequestDeviceOptions.optionalServices</dfn> is a list of <a>Service</a> UUIDs that aren't required for the website to use a device,
        but that the website can take advantage of if they're present.
      </p>

      <p>
        When the <dfn>BluetoothDiscovery.requestDevice</dfn> method is invoked, the UA MUST run the following steps:
        <ol>
          <li>Return a new <a>Promise</a>, but continue running these steps asynchronously.</li>
          <li id="requestDevice-authenticated-environment">
            If the <a href="http://www.whatwg.org/html/infrastructure.html#javascript-global-environment">global environment</a> is not an
            <a href="https://w3c.github.io/webappsec/specs/mixedcontent/#authenticated-environment">authenticated environment</a>,
            reject the <a>Promise</a> with a <a>SecurityError</a> and abort these steps.
          </li>
          <li id="requestDevice-user-gesture">
            If the algorithm is not <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#allowed-to-show-a-popup">allowed to show a popup</a>,
            reject the <a>Promise</a> with a <a>SecurityError</a> and abort these steps.
          </li>
          <li>
            <a>Scan for devices</a> with
            the union of all <code>services</code> sequences in <code><var>filters</var></code>
            as the <var>set of <a>Service</a> UUIDs</var>
          </li>
          <li>
            Remove devices from the result of the scan if
            they do not <a title="matches a filter">match a filter</a> in <var>filters</var>.
          <li>
            Display a prompt to the user requesting that the user specify some devices from the result of the scan.
            The UA SHOULD show the user the human-readable name of each device.
            If this name is not available because the UA's Bluetooth system doesn't support privacy-enabled scans,
            the UA SHOULD allow the user to indicate interest and then perform a privacy-disabled scan to retrieve the name.
            <p>
            The UA MAY allow the user to select a nearby device that does not match <var>filters</var>.
          </li>
          <li>
            Wait for the user to have made their selection.
          </li>
          <li>
            If the user cancels the prompt, reject the Promise with a <a>NotFoundError</a> and abort these steps.
          </li>
          <li>
            Record the selected device in the origin's <a>allowed devices list</a>
            and the union of the service UUIDs from <code>filters</code>
            and <code>options.optionalServices</code>
            in the device and origin's <a>allowed services list</a>.
          </li>
          <li>
            Connect to the device. ([[BLUETOOTH41]] 3.G.6.2.1)
            If the connection fails, reject the Promise with a <a>NetworkError</a> and abort these steps.
          </li>
          <li>
            Resolve the <a>Promise</a> with a <a>BluetoothDevice</a> instance representing the selected device.
          </li>
        </ol>
      </p>

      <p>
        A device <dfn>matches a filter</dfn> <var>filter</var> if
      <ul>
        <li><code><var>filter</var>.services</code> is not empty and</li>
        <li>
          the UA has received advertising data, an <a>extended inquiry response</a>,
          or a service discovery response indicating that
          the device supports each of the <a>Service</a> UUIDs
          included in <code><var>filter</var>.services</code> as a primary (vs included) service.
      </ul>

      <p class="note">
        The list of Service UUIDs that a device advertises
        might not include all the UUIDs the device supports.
        The advertising data does specify whether this list is complete.
        If a website filters for a UUID that a nearby device supports but doesn't advertise,
        that device might not be included in the list of devices presented to the user.
        The UA would need to connect to the device to discover the full list of supported services,
        which can impair radio performance and cause delays, so this spec doesn't require it.

      <p>
        To <dfn>scan for devices</dfn> with
        an optional <var>set of <a>Service</a> UUIDs</var>, defaulting to the set of all UUIDs,
        the UA MUST perform the following steps:

      <ol>
        <li>
          If the UA has scanned for devices recently
          <span class="issue">TODO: Nail down the amount of time.</span>
          with a set of UUIDs that was a superset of the UUIDs for the current scan,
          then the UA MAY return the result of that scan and abort these steps.
        <li>Let <var>result</var> be a set of Bluetooth devices, initially empty.
        <li>If the UA supports the LE transport:
          <ol>
            <li>
              The UA MUST perform the <dfn>General Discovery Procedure</dfn> ([[BLUETOOTH41]] 3.C.9.2.6).
              The UA SHOULD enable the <dfn>Privacy Feature</dfn> ([[BLUETOOTH41]] 3.C.10.7).

              <p class="issue">
                Both <dfn>passive scanning</dfn> ([[!BLUETOOTH41]] 6.B.4.4.3.1) and
                the <a>Privacy Feature</a> avoid leaking the unique, immutable device ID.
                We ought to require UAs to use either one,
                but none of the OS APIs appear to expose either.
                Bluetooth also makes it hard to use <a>passive scanning</a> since
                it doesn't require <a>Central</a> devices to support the
                <dfn>Observation Procedure</dfn> ([[!BLUETOOTH41]] 3.C.9.1.2).

            <li>
              For each <dfn>discovered LE device</dfn> ([[BLUETOOTH41]] 3.C.9.2.6),
              if the complete device name was not acquired during the <a>General Discovery Procedure</a>,
              the UA SHOULD perform the <dfn>Name Discovery Procedure</dfn> ([[BLUETOOTH41]] 3.C.9.2.7).

            <li>
              For each <a>discovered LE device</a>,
              if the advertised Service UUIDs ([[BLUETOOTH-SUPPLEMENT4]], A.1.1)
              have a non-empty intersection with the <var>set of <a>Service</a> UUIDs</var>,
              add the device to <var>result</var>.

            <li>
              For each <a>discovered LE device</a>,
              the UA MAY connect to the device and
              <ul>
                <li>
                  Use <dfn>Attribute Caching</dfn> ([[BLUETOOTH41]] 3.G.2.5.2) and
                  the <dfn>Service Changed characteristic</dfn> ([[BLUETOOTH41]] 3.G.7.1) to
                  recall and validate the supported Service UUIDs from a previous connection,
                <li>
                  <dfn>Discover Primary Service by Service UUID</dfn> ([[BLUETOOTH41]] 3.G.4.4.2)
                  for each UUID in the <var>set of <a>Service</a> UUIDs</var>, or
                <li>
                  <dfn>Discover All Primary Services</dfn> ([[BLUETOOTH41]] 3.G.4.4.1).
              </ul>
              If one of the discovered services is in the <var>set of <a>Service</a> UUIDs</var>,
              add the device to <var>result</var>.

              <div class="note" id="note-extra-discovery">
                <p>
                  Connecting to every nearby device to discover services costs power and
                  can slow down other use of the Bluetooth radio.
                  UAs should only discover extra services on a device if
                  they have some reason to expect that device to be interesting.

                <p>
                  UAs should also help developers avoid relying on this extra discovery behavior.
                  For example, say a developer has previously connected to a device,
                  so the UA knows the device's full set of supported services.
                  If this developer then filters using a non-advertised UUID,
                  the dialog they see may include this device,
                  even if the filter would likely exclude the device on users' machines.
                  The UA could provide a developer option to warn when this happens or
                  to include only advertised services in matching filters.
              </div>
          </ol>
        <li>If the UA supports the BR/EDR transport:
          <ol>
            <li>
              The UA MUST perform the <dfn>Device Discovery</dfn> procedure ([[BLUETOOTH41]] 3.C.6.4).

              <p class="issue">
                All forms of BR/EDR inquiry/discovery
                appear to leak the unique, immutable device address.

            <li>
              For each <dfn>discovered BR/EDR device</dfn> ([[BLUETOOTH41]] 3.C.6.4.3),
              if the Service UUIDs ([[BLUETOOTH-SUPPLEMENT4]], A.1.1)
              in the <dfn>Extended Inquiry Response</dfn> ([[BLUETOOTH41]] 1.A.4.2.1.1.1)
              have a non-empty intersection with the <var>set of <a>Service</a> UUIDs</var>,
              add the device to <var>result</var>.

              <p class="note">
                There is no way to distinguish GATT from non-GATT services
                in the <a>Extended Inquiry Response</a>.
                If a site filters to the UUID of a non-GATT service,
                the user may be able to select a device
                for the result of <code>requestDevice</code>
                that this API provides no way to interact with.

            <li>
              For each <a>discovered BR/EDR device</a>,
              the UA MAY connect to the device and
              <ul>
                <li>
                  Use <a>Attribute Caching</a> and the <a>Service Changed characteristic</a> to
                  recall and validate the supported Service UUIDs from a previous connection,
                <li>
                  <a>Discover Primary Service by Service UUID</a>
                  for each UUID in the <var>set of <a>Service</a> UUIDs</var>,
                <li>
                  <a>Discover All Primary Services</a>, or
                <li>
                  use the Service Discovery Protocol (<abbr title="Service Discovery Protocol">SDP</abbr>)
                  to find GATT Services with UUIDs in the <var>set of <a>Service</a> UUIDs</var>.
                  ([[BLUETOOTH41]] 3.B.2.5)
              </ul>
              If one of the discovered services is in the <var>set of <a>Service</a> UUIDs</var>,
              add the device to <var>result</var>.

              <p class="note">
                See the <a href="#note-extra-discovery">note for discovered LE devices</a>.
          </ol>
        <li>Return <var>result</var> from the scan.
      </ol>

      <p class="issue">
        We need a way for a site to register to receive an event
        when an interesting device comes within range.


      <section>
        <h2><a>BluetoothDevice</a></h2>

        <p>Represents a known Bluetooth device.
        <pre class="idl">
          interface BluetoothDevice : ServiceEventHandlers {
            readonly attribute DOMString instanceId;
            readonly attribute DOMString? name;

            readonly attribute long? deviceClass;

            readonly attribute VendorIdSource? vendorIdSource;
            readonly attribute long? vendorId;
            readonly attribute long? productId;
            readonly attribute long? productVersion;

            readonly attribute boolean? paired;
            readonly attribute boolean? connected;

            sequence&lt;UUID>? uuids();

            Promise&lt;void> connect();
            Promise&lt;void> disconnect();

            Promise&lt;BluetoothGATTService> getPrimaryService(BluetoothServiceUuid service);
            Promise&lt;sequence&lt;BluetoothGATTService>> getPrimaryServices();
            Promise&lt;sequence&lt;BluetoothGATTService>> getPrimaryServices(BluetoothServiceUuid service);
            Promise&lt;sequence&lt;BluetoothGATTService>> getPrimaryServices(sequence&lt;BluetoothServiceUuid> services);
          };

          enum VendorIdSource {
            "bluetooth",
            "usb"
          };
        </pre>

        <p>
          <dfn>BluetoothDevice.instanceId</dfn> returns the opaque identifier assigned to this device.
          This identifier MUST uniquely identify a device to the extent that
          the UA can determine that two Bluetooth connections are to the same device.
          For example, a paired device MUST keep the same <code>instanceId</code>
          across a change to its <a>Resolvable Private Address</a>.
          On the other hand, a device using <a>Non-Resolvable Private Address</a>es
          might not keep the same <code>instanceId</code>.
          The UA MAY use different identifiers for the same device on two different origins.
          The UA MAY create a new identifier for a known device on an origin
          if the user revokes and re-grants access to that device.
          The UA MAY re-use identifiers for existing devices on an origin
          if the user clears the origin's data.
        </p>
        <p><dfn>BluetoothDevice.name</dfn> is the human-readable name of the device.</p>
        <p><dfn>BluetoothDevice.deviceClass</dfn> is the class of the device, a bit-field defined by [[!BLUETOOTH-ASSIGNED-BASEBAND]].</p>
        <p><dfn>BluetoothDevice.vendorIdSource</dfn> is the Vendor ID Source field
        in the <a href="https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.pnp_id.xml">pnp_id</a> characteristic
        in the <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.device_information.xml">device_information</a> service.</p>
        <p><dfn>BluetoothDevice.vendorId</dfn> is the 16-bit Vendor ID field
        in the <a href="https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.pnp_id.xml">pnp_id</a> characteristic
        in the <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.device_information.xml">device_information</a> service.</p>
        <p><dfn>BluetoothDevice.productId</dfn> is the 16-bit Product ID field
        in the <a href="https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.pnp_id.xml">pnp_id</a> characteristic
        in the <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.device_information.xml">device_information</a> service.</p>
        <p>
          <dfn>BluetoothDevice.productVersion</dfn> is the 16-bit Product Version field in the
          <a href="https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.pnp_id.xml">pnp_id</a>
          characteristic in the
          <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.device_information.xml">device_information</a>
          service.
        </p>
        <p><dfn>BluetoothDevice.paired</dfn> indicates whether or not the device is paired with the system.</p>
        <p><dfn>BluetoothDevice.connected</dfn> indicates whether the device is currently connected to the system.</p>
        <p>
          <dfn>BluetoothDevice.uuids</dfn> lists the UUIDs of protocols, profiles and services advertised by the device.
          For Low Energy devices, this list is obtained from AD and GATT primary services.
        </p>
        <p>
          <dfn>BluetoothDevice.connect</dfn> establishes a connection to the device.
        </p>
        <p>
          <dfn>BluetoothDevice.disconnect</dfn> closes the site's connection to the device.
          Note that this will not always destroy the physical link itself,
          since there may be other sites with open connections.
        </p>

        <p>
          <dfn>BluetoothDevice.getPrimaryService</dfn> returns a promise that is asynchronously resolved with
          the <a href="#bluetooth-tree">first</a> primary GATT service on the remote device
          whose UUID is <var>service</var> and
          whose UUID is in the <a>allowed services list</a> for this device and origin.
          If there is no such service, resolves the promise with <code>null</code>.
        </p>

        <p>
          When passed no arguments, <dfn>BluetoothDevice.getPrimaryServices</dfn> returns a promise that is asynchronously resolved with
          a sequence of all the primary GATT services on the remote device
          whose UUIDs are in the <a>allowed services list</a> for this device and origin. When passed a single <a>BluetoothServiceUuid</a> argument, behaves as if it were passed an array containing just that service. When passed a sequence of <a>BluetoothServiceUuid</a>s, returns a promise that is asynchronously resolved with
          a sequence of all the primary GATT services on the remote device with UUIDs in
          both <var>services</var> and the <a>allowed services list</a> for this device and origin.
        </p>

        <p><dfn>VendorIdSource</dfn> represents the allocation authorities for Vendor IDs.</p>
      </section>
    </section>

    <section>
      <h2>GATT Interaction</h2>

      <section>
        <h2><a>BluetoothGATTService</a></h2>

        <p><a>BluetoothGATTService</a> represents a GATT <a>Service</a> within a Bluetooth <a>Peripheral</a>, a collection of characteristics and relationships to other services that encapsulate the behavior of part of a device.</p>
        <pre title="" class="idl">
          interface BluetoothGATTService : ServiceEventHandlers {
            readonly attribute UUID uuid;
            readonly attribute boolean isPrimary;
            readonly attribute DOMString instanceId;
            readonly attribute BluetoothDevice device;

            Promise&lt;BluetoothGATTCharacteristic> getCharacteristic(BluetoothCharacteristicUuid characteristic);
            Promise&lt;sequence&lt;BluetoothGATTCharacteristic>> getCharacteristics();
            Promise&lt;sequence&lt;BluetoothGATTCharacteristic>> getCharacteristics(BluetoothCharacteristicUuid characteristic);
            Promise&lt;sequence&lt;BluetoothGATTCharacteristic>> getCharacteristics(sequence&lt;BluetoothCharacteristicUuid> characteristics);

            Promise&lt;BluetoothGATTService> getIncludedService(BluetoothServiceUuid service);
            Promise&lt;sequence&lt;BluetoothGATTService>> getIncludedServices();
            Promise&lt;sequence&lt;BluetoothGATTService>> getIncludedServices(BluetoothServiceUuid service);
            Promise&lt;sequence&lt;BluetoothGATTService>> getIncludedServices(sequence&lt;BluetoothServiceUuid> services);
          };
        </pre>
          <p><dfn>BluetoothGATTService.uuid</dfn> is the UUID of the service, e.g. <code><a>UUID</a>.parse('0000180d-0000-1000-8000-00805f9b34fb')</code>.</p>
          <p><dfn>BluetoothGATTService.isPrimary</dfn> indicates whether the type of this service is primary or secondary.</p>
          <p>
            <dfn>BluetoothGATTService.instanceId</dfn> returns the opaque identifier assigned to this service,
            which can be used distinguish between
            multiple primary services with the same UUID in a single device or
            multiple included services with the same UUID in a single primary service.
            This identifier MUST be unique among all services accessible by this website.
            This identifier MUST continue referring to the same <a>Service</a> until either
            an <code>onServiceRemoved</code> event is delivered referring to this <a>BluetoothGATTService</a> or
            if this service's device is not <a title="BluetoothDevice.paired"><code>paired</code></a>, it is disconnected.
          </p>
          <p>
            <dfn>BluetoothGATTService.device</dfn> is the <a>BluetoothDevice</a> representing
            the remote peripheral that the GATT service belongs to.
          </p>
          <p>
            <dfn>BluetoothGATTService.getCharacteristic</dfn> returns a promise that is asynchronously resolved with
            the <a href="#bluetooth-tree">first</a> GATT characteristic within this Service
            whose UUID is <var>characteristic</var>.
          </p>
          <p>
            When called with no arguments, <dfn>BluetoothGATTService.getCharacteristics</dfn> returns a promise that is asynchronously resolved with a sequence of all the GATT characteristics within this Service.
            When passed a single <a>BluetoothCharacteristicUuid</a> argument, behaves as if it were passed an array containing just that characteristic.
            When passed a sequence of <a>BluetoothCharacteristicUuid</a>s, returns a promise that is asynchronously resolved with a sequence of all the GATT characteristics within this Service with UUIDs in <var>characteristics</var>.
          </p>
          <p>
            <dfn>BluetoothGATTService.getIncludedService</dfn> returns a promise that is asynchronously resolved with the first GATT included service
            (in the order returned by the Find Included Services procedure: [[BLUETOOTH41]] 3.G.4.5.1)
            within this Service whose UUID is <var>service</var>.
          </p>

          <p>
            When called with no arguments, <dfn>BluetoothGATTService.getIncludedServices</dfn> returns a promise that is asynchronously resolved with a sequence of all the GATT included services within this Service.
            When passed a single <a>BluetoothServiceUuid</a> argument, behaves as if it were passed an array containing just that service.
            When passed a sequence of <a>BluetoothServiceUuid</a>s, returns a promise that is asynchronously resolved with a sequence of all the GATT included services within this Service with UUIDs in <var>services</var>.
          </p>
          <p class="note">
            Bluetooth's procedure for finding included services (3.G.4.5) doesn't include a way to optimize for a single UUID.
            Maybe we should omit the versions of <code><a>BluetoothGATTService.getIncludedServices</a>()</code> taking parameters to avoid implying that they're more efficient than the no-argument version.
          </p>
      </section>

      <section>
        <h2><a>BluetoothGATTCharacteristic</a></h2>

        <p><dfn>BluetoothGATTCharacteristic</dfn> represents a GATT <a>Characteristic</a>, which is a basic data element that provides further information about a peripheral's service.</p>
        <pre class="idl">
          interface BluetoothGATTCharacteristic : CharacteristicEventHandlers {
            readonly attribute UUID uuid;
            readonly attribute BluetoothGATTService service;
            readonly attribute CharacteristicProperty[] properties;
            readonly attribute DOMString instanceId;
            readonly attribute ArrayBuffer? value;

            Promise&lt;BluetoothGATTDescriptor> getDescriptor(BluetoothDescriptorUuid descriptor);
            Promise&lt;sequence&lt;BluetoothGATTDescriptor>> getDescriptors();
            Promise&lt;sequence&lt;BluetoothGATTDescriptor>> getDescriptors(BluetoothDescriptorUuid descriptor);
            Promise&lt;sequence&lt;BluetoothGATTDescriptor>> getDescriptors(sequence&lt;BluetoothDescriptorUuid> descriptors);

            Promise&lt;ArrayBuffer> readValue();
            Promise&lt;void> writeValue(ArrayBuffer value);

            Promise&lt;void> startNotifications();
            Promise&lt;void> stopNotifications();
          };
        </pre>

        <p><dfn>BluetoothGATTCharacteristic.uuid</dfn> is the UUID of the characteristic, e.g. <code><a>UUID</a>.parse('00002a37-0000-1000-8000-00805f9b34fb')</code>.</p>
        <p><dfn>BluetoothGATTCharacteristic.service</dfn> is the GATT service this characteristic belongs to.</p>
        <p><dfn>BluetoothGATTCharacteristic.properties</dfn> lists the properties of this characteristic.</p>
        <p>
          <dfn>BluetoothGATTCharacteristic.instanceId</dfn> returns the opaque identifier assigned to this characteristic,
          which can be used distinguish between multiple characteristics
          with the same UUID in a single service.
          This identifier MUST be unique among all characteristics accessible by this website.
          This identifier MUST continue referring to the same <a>Characteristic</a> until either
          an <code>onServiceRemoved</code> or <code>onServiceChanged</code> event is delivered
          referring to the <a>BluetoothGATTService</a> of this characteristic or
          if this characteristic's <a>BluetoothDevice</a> is not <a title="BluetoothDevice.paired"><code>paired</code></a>, it is disconnected.
        </p>

        <p>
          <dfn>BluetoothGATTCharacteristic.value</dfn> stores the currently cached characteristic value.
          This value gets updated when the value of the characteristic is read or updated via a notification or indication.
        </p>

        <p>
          <dfn>BluetoothGATTCharacteristic.getDescriptor</dfn> returns a promise that is asynchronously resolved with
          the <a href="#bluetooth-tree">first</a> GATT descriptor within this Characteristic
          whose UUID is <var>descriptor</var>.
        </p>

        <p>
          When passed no arguments, <dfn>BluetoothGATTCharacteristic.getDescriptors</dfn> returns a promise that is asynchronously resolved with a sequence of all the GATT descriptors within this Characteristic.
          When passed a single <a>BluetoothDescriptorUuid</a> argument, behaves as if it were passed an array containing just that descriptor.
          When passed a sequence of <a>BluetoothDescriptorUuid</a>s, returns a promise that is asynchronously resolved with a sequence of all the GATT descriptors within this Characteristic with UUIDs in <var>descriptors</var>.
        </p>

        <p>
          When <dfn>BluetoothGATTCharacteristic.readValue</dfn> is called, the UA MUST perform the following steps:
        </p>
        <ol>
          <li>
            Return a new promise and run the remaining steps in parallel.
          </li>
          <li>
            Let <var>characteristic</var> be the <a>Characteristic</a>
            that the <a>BluetoothGATTCharacteristic</a> represents.
          </li>
          <li>
            If the <code>Read</code> bit is not set
            in <var>characteristic</var>'s properties ([[!BLUETOOTH41]] 3.G.3.3.1.1),
            reject the promise with a <a>NotSupportedError</a> and abort these steps.
          </li>
          <li>
            Use any combination of the sub-procedures in
            the Characteristic Value Read procedure ([[!BLUETOOTH41]] 3.G.4.8)
            to retrieve the value of <var>characteristic</var>.
            <a>Use the Bluetooth error recovery procedure</a> with the promise.
            If this fails, abort these steps.
          </li>
          <li>
            Create an <code>ArrayBuffer</code> holding the retrieved value,
            and assign it to the <a>BluetoothGATTCharacteristic</a>'s <code>value</code> field.
          </li>
          <li>
            <a href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
            named <a><code>characteristicvaluechanged</code></a>
            with its <code>bubbles</code> attribute initialized to <code>true</code>
            at the <a>BluetoothGATTCharacteristic</a>.
          </li>
        </ol>

        <p>
          When <code><dfn>BluetoothGATTCharacteristic.writeValue</dfn>(value)</code> is called,
          the UA MUST write <code>value</code> to this characteristic on the remote peripheral.
        </p>

        <p>
          For each known GATT <a>Characteristic</a>, the UA MUST maintain
          an <dfn>active notification context set</dfn> of <a>BluetoothInteraction</a> objects.
          This is a single set for the whole UA,
          pointing to the <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a> object
          for each separate script execution environment that has registered for notifications.

        <p>
          When <dfn>BluetoothGATTCharacteristic.startNotifications</dfn> is called, the UA MUST run the following steps:
        </p>
        <ol>
          <li>
            Return a new promise and run the remaining steps in parallel.
          </li>
          <li>
            Let <var>characteristic</var> be
            the GATT <a>Characteristic</a> that the <a>BluetoothGATTCharacteristic</a> represents.
          </li>
          <li>
            If neither of the <code>Notify</code> or <code>Indicate</code> bits are set
            in <var>characteristic</var>'s properties ([[!BLUETOOTH41]] 3.G.3.3.1.1),
            reject the promise with a <a>NotSupportedError</a> and abort these steps.
          </li>
          <li>
            If the <a>active notification context set</a> contains
            <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a>,
            resolve the promise and abort these steps.
          </li>
          <li>
            Ensure that one of the <code>Notification</code> or <code>Indication</code> bits in
            <var>characteristic</var>'s Client Characteristic Configuration descriptor ([[!BLUETOOTH41]] 3.G.3.3.3.3)
            is set, matching the constraints in <var>characteristic</var>'s properties.
            The UA SHOULD avoid setting both bits,
            and MUST deduplicate <a href="#notification-events">value-change events</a>
            if both bits are set.
            <a>Use the Bluetooth error recovery procedure</a> with the promise.
            If this fails, abort these steps.
          </li>
          <li>
            Add <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a>
            to the <a>active notification context set</a>.
          </li>
          <li>
            Resolve the promise.
          </li>
        </ol>

        <p class="note">
          After notifications are enabled,
          the resulting <a href="#notification-events">value-change events</a> won't be delivered
          until after the current
          <a href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint">microtask checkpoint</a>.
          This allows a developer to set up handlers
          in the <code>.then</code> handler of the result promise.

        <p>
          When <dfn>BluetoothGATTCharacteristic.stopNotifications</dfn> is called, the UA MUST run the following steps:
        </p>
        <ol>
          <li>
            Return a new promise and run the remaining steps in parallel.
          </li>
          <li>
            Let <var>characteristic</var> be
            the GATT <a>Characteristic</a> that the <a>BluetoothGATTCharacteristic</a> represents.
          </li>
          <li>
            If the <a>active notification context set</a> contains
            <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a>,
            remove it.
          </li>
          <li>
            If the <a>active notification context set</a> became empty,
            the UA SHOULD clear the <code>Notification</code> and <code>Indication</code> bits in
            <var>characteristic</var>'s Client Characteristic Configuration descriptor ([[!BLUETOOTH41]] 3.G.3.3.3.3).
          </li>
          <li>
            <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a>
            to resolve the promise.
          </li>
        </ol>

        <p class="note">
          Queuing a task to resolve the promise ensures that
          no <a href="#notification-events">value change events</a> due to notifications
          arrive after the promise resolves.
      </section>

      <section>
        <h2><a>BluetoothGATTDescriptor</a></h2>

        <p><dfn>BluetoothGATTDescriptor</dfn> represents a GATT <a>Descriptor</a>, which provides further information about a <a>Characteristic</a>'s value.</p>
        <pre class="idl">
          interface BluetoothGATTDescriptor {
            readonly attribute UUID uuid;
            readonly attribute BluetoothGATTCharacteristic characteristic;
            readonly attribute DOMString instanceId;
            readonly attribute ArrayBuffer? value;
            Promise&lt;ArrayBuffer> readValue();
            Promise&lt;void> writeValue(ArrayBuffer value);
          };
        </pre>
        <p><dfn>BluetoothGATTDescriptor.uuid</dfn> is the UUID of the characteristic descriptor, e.g. <code>'00002902-0000-1000-8000-00805f9b34fb'</code>.</p>
        <p><dfn>BluetoothGATTDescriptor.characteristic</dfn> is the GATT characteristic this descriptor belongs to.</p>
        <p>
          <dfn>BluetoothGATTDescriptor.instanceId</dfn> returns the opaque identifier assigned to this descriptor,
          which can be used distinguish between multiple descriptors
          with the same UUID in a single characteristic.
          This identifier MUST be unique among all descriptors accessible by this website.
          This identifier MUST continue referring to the same <a>Descriptor</a> until either
          an <code>onServiceRemoved</code> or <code>onServiceChanged</code> event is delivered
          referring to the <a>BluetoothGATTService</a> of this descriptor or
          if this descriptor's device is not <a title="BluetoothDevice.paired"><code>paired</code></a>, it is disconnected.
          Use the instance ID to distinguish between descriptors from a peripheral with the same UUID and
          to make function calls that take in a descriptor identifier.
          Present, if this instance represents a remote characteristic.
        </p>
        <p>
          <dfn>BluetoothGATTDescriptor.value</dfn> is the currently cached descriptor value.
          This value gets updated when the value of the descriptor is read.
        </p>
        <p>
          <dfn>BluetoothGATTDescriptor.readValue</dfn> retrieves the value of this descriptor from a remote peripheral.
          Updates the descriptor's <code>value</code> field to hold the result of the read request and resolves the promise with the same <a>ArrayBuffer</a>.
        </p>
        <p>
          <code><dfn>BluetoothGATTDescriptor.writeValue</dfn>(value)</code> writes <code>value</code> to this descriptor on a remote peripheral.
        </p>
      </section>

      <section>
        <h2>Object and UUID lookup on <code>navigator.bluetooth</code></h2>

        <pre class="idl">
          [NoInterfaceObject]
          interface BluetoothInteraction : ServiceEventHandlers {
            readonly attribute BluetoothUuids uuids;

            Promise&lt;BluetoothGATTService> getService(DOMString serviceInstanceId);
            Promise&lt;BluetoothGATTCharacteristic> getCharacteristic(DOMString characteristicInstanceId);
            Promise&lt;BluetoothGATTDescriptor> getDescriptor(DOMString descriptorInstanceId);
          };
        </pre>

        <p>
          <code><dfn>BluetoothInteraction.getService</dfn>(serviceInstanceId)</code> returns the GATT service with the given instance ID.
        </p>
        <p>
          <code><dfn>BluetoothInteraction.getCharacteristic</dfn>(characteristicInstanceId)</code> returns the GATT characteristic with the given instance ID that belongs to the given GATT service, if the characteristic exists.
        </p>
        <p>
          <code><dfn>BluetoothInteraction.getDescriptor</dfn>(descriptorInstanceId)</code> returns the GATT characteristic descriptor with the given instance ID.
        </p>
      </section>

      <section>
        <h2>Events</h2>

        <section id="bluetooth-tree">
          <h2>Bluetooth Tree</h2>

          <p>
            <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a> and
            objects implementing the <a>BluetoothDevice</a>, <a>BluetoothGATTService</a>,
            <a>BluetoothGATTCharacteristic</a>, or <a>BluetoothGATTDescriptor</a> interface
            <a href="https://dom.spec.whatwg.org/#concept-tree-participate">participate in a tree</a>,
            simply named the <dfn>Bluetooth tree</dfn>.

          <ul>
            <li>
              The <a href="https://dom.spec.whatwg.org/#concept-tree-child">children</a>
              of <a href="#widl-NavigatorBluetooth-bluetooth"><code>navigator.bluetooth</code></a>
              are the <a>BluetoothDevice</a> objects representing
              devices on the origin's <a>allowed devices list</a>,
              in an unspecified order.
            </li>
            <li>
              The <a href="https://dom.spec.whatwg.org/#concept-tree-child">children</a>
              of a <a>BluetoothDevice</a> are the <a>BluetoothGATTService</a> objects representing
              Primary and Secondary <a>Service</a>s on its GATT <a>Server</a>
              whose UUIDs are on the origin and device's <a>allowed services list</a>.
              The order of the primary services MUST be consistent with the order returned by
              the Discover Primary Service by Service UUID procedure ([[!BLUETOOTH41]] 3.G.4.4.2),
              but secondary services and primary services with different UUIDs may be in any order.
            </li>
            <li>
              The <a href="https://dom.spec.whatwg.org/#concept-tree-child">children</a>
              of a <a>BluetoothGATTService</a> are
              the <a>BluetoothGATTCharacteristic</a> objects representing its Characteristics.
              The order of the characteristics MUST be consistent with the order returned by
              the Discover Characteristics by UUID procedure ([[!BLUETOOTH41]] 3.G.4.6.2),
              but characteristics with different UUIDs may be in any order.
            </li>
            <li>
              The <a href="https://dom.spec.whatwg.org/#concept-tree-child">children</a>
              of a <a>BluetoothGATTCharacteristic</a> are
              the <a>BluetoothGATTDescriptor</a> objects representing its Descriptors
              in the order returned by the Discover All Characteristic Descriptors procedure ([[!BLUETOOTH41]] 3.G.4.7.1)
            </li>
          </ul>
        </section>

        <section id="event-types">
          <h2>Event types</h2>

          <dl>
            <dt><dfn><code>characteristicvaluechanged</code></dfn></dt>
            <dd>
              Fired on a <a>BluetoothGATTCharacteristic</a> when its value changes,
              either as a result of
              a <a href="#widl-BluetoothGATTCharacteristic-readValue-Promise-ArrayBuffer">read request</a>,
              or a <a href="#notification-events">value change notification/indication</a>.
            </dd>

            <dt><dfn><code>serviceadded</code></dfn></dt>
            <dd>
              Fired on a new <a>BluetoothGATTService</a>
              <a href="#service-change-events">when it has been discovered on a remote device</a>,
              just after it is added to the <a>Bluetooth tree</a>.
            </dd>

            <dt><dfn><code>servicechanged</code></dfn></dt>
            <dd>
              Fired on a <a>BluetoothGATTService</a>
              <a href="#service-change-events">when its state changes</a>.
              This involves any characteristics and/or descriptors
              that get added or removed from the service,
              as well as Service Changed indications ([[!BLUETOOTH41]] 3.G.7.1) from the remote device.
            </dd>

            <dt><dfn><code>serviceremoved</code></dfn></dt>
            <dd>
              Fired on a <a>BluetoothGATTService</a>
              <a href="#service-change-events">when it has been removed from its device</a>,
              just before it is removed from the <a>Bluetooth tree</a>.
            </dd>

          </dl>
        </section>

        <section id="notification-events">
          <h2>Responding to Notifications and Indications</h2>

          <p>
            When the UA receives a Bluetooth Notification ([[!BLUETOOTH41]] 3.G.4.10)
            or Indication ([[!BLUETOOTH41]] 3.G.4.11) for a <a>Characteristic</a>,
            it must perform the following steps:

          <ol>
            <li>
              For each <var>bluetoothGlobal</var> in
              the <a>active notification context set</a> for the Characteristic,
              <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
              on the event loop of the script settings object of <var>bluetoothGlobal</var>
              to do the following steps:

              <ol>
                <li>
                  Let <var>characteristicObject</var> be the <a>BluetoothGATTCharacteristic</a> in
                  the <a>Bluetooth tree</a> rooted at <var>bluetoothGlobal</var>
                  that represents the <a>Characteristic</a>.
                </li>
                <li>
                  Set <code><var>characteristicObject</var>.value</code> to
                  a new <code>ArrayBuffer</code> holding the new value of the <a>Characteristic</a>.
                </li>
                <li>
                  <a href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
                  named <a><code>characteristicvaluechanged</code></a>
                  with its <code>bubbles</code> attribute initialized to <code>true</code>
                  at <var>characteristicObject</var>.
                </li>
              </ol>
            </li>
          </ol>
        </section>

        <section id="service-change-events">
          <h2>Responding to Service Changes</h2>

          <p>
            The Bluetooth Attribute Caching system ([[!BLUETOOTH41]] 3.G.2.5.2) allows clients
            to track changes to <a>Service</a>s, <a>Characteristic</a>s, and <a>Descriptor</a>s.
            Before discovering any of these entities for the purpose of exposing them to a web page
            the UA MUST subscribe to Indications from the
            Service Changed characteristic ([[!BLUETOOTH41]] 3.G.7.1), if it exists.
            When the UA receives an Indication on the Service Changed characteristic,
            it MUST perform the following steps.

          <ol>
            <li>
              Let <var>removedEntities</var> be the list of entities in
              the range indicated by the Service Changed characteristic
              that the UA had discovered before the Indication.
            </li>
            <li>
              Use the Primary Service Discovery, Relationship Discovery, Characteristic Discovery,
              and Characteristic Descriptor Discovery procedures
              ([[!BLUETOOTH41]] 3.G 4.4, 4.5, 4.6, and 4.7)
              to re-discover entities in the range indicated by the Service Changed characteristic.
              The UA MAY skip discovering all or part of the indicated range
              if it can prove that the results of that discovery
              could not affect the events fired below.
            </li>
            <li>
              Let <var>addedEntities</var> be the list of entities discovered in the previous step.
            </li>
            <li>
              If an entity with the same definition, ignoring Characteristic and Descriptor values,
              appears in both <var>removedEntities</var> and <var>addedEntities</var>,
              remove it from both.
            </li>
            <li>
              Let <var>changedServices</var> be a set of <a>Service</a>s, initially empty.
            </li>
            <li>
              If the same <a>Service</a> appears in both <var>removedEntities</var> and <var>addedEntities</var>,
              remove it from both, and add it to <var>changedServices</var>.
              <a>Service</a>s with different UUIDs or Primary/Secondary status
              MUST NOT be considered "the same",
              but this specification says nothing else about determining identity.
            </li>
            <li>
              For each <a>Characteristic</a> and <a>Descriptor</a>
              in <var>removedEntities</var> and <var>addedEntities</var>,
              remove it from its original list,
              and add its parent <a>Service</a> to <var>changedServices</var>.
              <span class="note">After this point, <var>removedEntities</var> and <var>addedEntities</var> contain only <a>Service</a>s.</span>
            </li>
            <li>
              If a <a>Service</a> in <var>addedEntities</var>
              would not have been returned to any script execution environment
              if it had existed at the time of any previous call to
              <code>getPrimaryService</code>, <code>getPrimaryServices</code>,
              <code>getIncludedService</code>, or <code>getIncludedServices</code>,
              the UA MAY remove the <a>Service</a> from <var>addedEntities</var>.
            </li>
            <li>
              Let <var>changedDevices</var> be the set of Bluetooth devices that
              contain any <a>Service</a> in
              <var>removedEntities</var>, <var>addedEntities</var>, and <var>changedServices</var>.
            </li>
            <li>
              For each script execution environment
              that is connected to a device in <var>changedDevices</var>,
              <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
              on its event loop to do the following steps:
              <ol>
                <li>
                  For each <a>Service</a> in <var>removedEntities</var>,
                  <a href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a>
                  named <a><code>serviceremoved</code></a>
                  with its <code>bubbles</code> attribute initialized to <code>true</code>
                  at the <a>BluetoothGATTService</a> representing the <a>Service</a>.
                  Then remove this <a>BluetoothGATTService</a> from the <a>Bluetooth tree</a>.
                </li>
                <li>
                  For each <a>Service</a> in <var>addedEntities</var>,
                  add the <a>BluetoothGATTService</a> representing this <a>Service</a> to the <a>Bluetooth tree</a>.
                  Then <a href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a>
                  named <a><code>serviceadded</code></a>
                  with its <code>bubbles</code> attribute initialized to <code>true</code>
                  at the <a>BluetoothGATTService</a>.
                </li>
                <li>
                  For each <a>Service</a> in <var>changedServices</var>,
                  <a href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a>
                  named <a><code>servicechanged</code></a>
                  with its <code>bubbles</code> attribute initialized to <code>true</code>
                  at the <a>BluetoothGATTService</a> representing the <a>Service</a>.
                </li>
              </ol>
            </li>
          </ol>
        </section>

        <section>
          <h2>IDL event handlers</h2>

          <pre class="idl">
            [NoInterfaceObject]
            interface CharacteristicEventHandlers : EventTarget {
              attribute EventHandler oncharacteristicvaluechanged;
            };

            [NoInterfaceObject]
            interface ServiceEventHandlers : CharacteristicEventHandlers {
              attribute EventHandler onserviceadded;
              attribute EventHandler onservicechanged;
              attribute EventHandler onserviceremoved;
            };
          </pre>
          <p>
            <dfn>oncharacteristicvaluechanged</dfn> is the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">Event handler IDL attribute</a>
            for the <a><code>characteristicvaluechanged</code></a> event type.
          </p>
          <p>
            <dfn>onserviceadded</dfn> is the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">Event handler IDL attribute</a>
            for the <a><code>serviceadded</code></a> event type.
          </p>
          <p>
            <dfn>onservicechanged</dfn> is the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">Event handler IDL attribute</a>
            for the <a><code>servicechanged</code></a> event type.
          </p>
          <p>
            <dfn>onserviceremoved</dfn> is the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">Event handler IDL attribute</a>
            for the <a><code>serviceremoved</code></a> event type.
          </p>
        </section>
      </section>

      <section>
        <h2>Error handling</h2>

        <p class="note">
          This section primarily defines the mapping from system errors to Javascript error names
          and allows UAs to retry certain operations.
          The retry logic and possible error distinctions
          are highly constrained by the operating system,
          so places these requirements don't reflect reality
          are likely spec bugs instead of browser bugs.

        <p>
          When a step in an algorithm that uses a Bluetooth GATT procedure ([[!BLUETOOTH41]] 3.G.4)
          says to "<dfn>Use the Bluetooth error recovery procedure</dfn>" with a promise,
          the UA MUST perform the following steps:

        <ol>
          <li>
            If the Bluetooth procedure completes with anything other than
            an <code>Error Response</code> ([[!BLUETOOTH41]] 3.F.3.4.1.1),
            the recovery procedure succeeds.
            Abort these steps.
          </li>
          <li>
            If the procedure times out ([[!BLUETOOTH41]] 3.G.4.14) or
            the ATT Bearer ([[!BLUETOOTH41]] 3.G.2.4) is terminated for any reason,
            reject the promise with a <a>NetworkError</a> and abort these steps.
            The recovery procedure fails.
          </li>
          <li>
            Take the following actions depending on the <code>Error Code</code>:
            <dl>
              <dt><code>Invalid Handle</code></dt>
              <dt><code>Invalid PDU</code></dt>
              <dt><code>Invalid Offset</code></dt>
              <dt><code>Attribute Not Found</code></dt>
              <dt><code>Unsupported Group Type</code></dt>
              <dd>
                These error codes indicate that something unexpected happened at the protocol layer,
                likely either due to a UA or device bug.
                Reject the promise with a <a>NotSupportedError</a>.
                The recovery procedure fails.
              </dd>

              <dt><code>Invalid Attribute Value Length</code></dt>
              <dd>
                Reject the promise with an <a>InvalidModificationError</a>.
                The recovery procedure fails.
              </dd>

              <dt><code>Attribute Not Long</code></dt>
              <dd>
                If this error code is received without having used a "Long" sub-procedure,
                this may indicate a device bug.
                Reject the promise with a <a>NotSupportedError</a>,
                and the recovery procedure fails.

                <p>
                  Otherwise, retry the GATT procedure without using a "Long" sub-procedure.
                  If this is impossible due to the length of the value being written,
                  reject the promise with an <a>InvalidModificationError</a>,
                  and the recovery procedure fails.
              </dd>

              <dt><code>Insufficient Authentication</code></dt>
              <dt><code>Insufficient Encryption</code></dt>
              <dt><code>Insufficient Encryption Key Size</code></dt>
              <dd>
                The UA SHOULD attempt to increase the security level of the connection.
                If this attempt fails or the UA doesn't support any higher security,
                reject the promise with a <a>SecurityError</a>,
                and the recovery procedure fails.
                Otherwise, retry the GATT procedure at the new higher security level.
              </dd>

              <dt><code>Insufficient Authorization</code></dt>
              <dd>
                Reject the promise with a <a>SecurityError</a>,
                and the recovery procedure fails.
              </dd>

              <dt><code>Read Not Permitted</code></dt>
              <dt><code>Write Not Permitted</code></dt>
              <dt><code>Request Not Supported</code></dt>
              <dt><code>Prepare Queue Full</code></dt>
              <dt><code>Insufficient Resources</code></dt>
              <dt><code>Unlikely Error</code></dt>
              <dt>Anything else</dt>
              <dd>
                Reject the promise with a <a>NotSupportedError</a>.
                The recovery procedure fails.
              </dd>
            </dl>
          </li>
        </ol>
      </section>
    </section>

    <section>
      <h2>UUIDs</h2>

      <pre class="idl">
        typedef DOMString UUID;
      </pre>
      <p>
        A <a>UUID</a> string represents a 128-bit [[!RFC4122]] UUID.
        A <dfn>valid UUID</dfn> is a string that matches
        the [[!ECMAScript]] regexp
        <code>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/</code>.
        That is, a <a>valid UUID</a> is lower-case and
        does not use the 16- or 32-bit abbreviations defined by the Bluetooth standard.
        All UUIDs returned from functions and attributes in this specification
        MUST be <a>valid UUID</a>s.
        If a function in this specification takes a parameter whose type is <a>UUID</a>
        or a dictionary including a <a>UUID</a> attribute,
        and the argument passed in any <a>UUID</a> slot is not a <a>valid UUID</a>,
        the function MUST return a <a>Promise</a> rejected with a <code>TypeError</code>
        and abort its other steps.

      <p class="note">
        This standard provides the
        <a href="#widl-BluetoothUuids-canonicalUUID-UUID-unsigned-long-alias"><code>canonicalUUID()</code></a> function
        to map a 16- or 32-bit Bluetooth UUID alias to its 128-bit form.

      <p class="note">
        Bluetooth devices are required to convert 16- and 32-bit UUIDs to 128-bit UUIDs
        before comparing them ([[BLUETOOTH41]] 3.F.3.2.1), but not all devices do so.
        To interoperate with these devices,
        if the UA has received a UUID from the device in one form (16-, 32-, or 128-bit),
        it should send other aliases of that UUID back to the device in the same form.
    </section>

    <section>
      <h2>Standardized identifiers</h2>

      <p>
        The Bluetooth standard defines numbers that identify services, characteristics, descriptors, and other entities.
        This section provides javascript names for these constants so they don't need to be replicated in each application.

      <pre class="idl">
        [NoInterfaceObject]
        interface BluetoothUuids {
          readonly attribute BluetoothUuidsService service;
          readonly attribute BluetoothUuidsCharacteristic characteristic;
          readonly attribute BluetoothUuidsDescriptor descriptor;
          UUID canonicalUUID(unsigned long alias);
        };
      </pre>
      <p>
        <dfn>canonicalUUID</dfn> returns a 128-bit <a>UUID</a> given a 16- or 32-bit Bluetooth UUID alias.
        The algorithm for converting an alias to a full 128-bit UUID is defined in [[!BLUETOOTH41]] Volume 3 Part B Section 2.5.1:
        the top 32 bits of "<code>00000000-0000-1000-8000-00805f9b34fb</code>" are replaced by the bits of the alias.
        For example, <code>canonicalUUID(0xDEADBEEF)</code> returns <code>"deadbeef-0000-1000-8000-00805f9b34fb"</code>.
      </p>

      <section>
        <h2>Standard GATT Services</h2>

        <p>Each standardized service listed in [[!BLUETOOTH-NUMBERS-SERVICES]] MUST be reflected into <code>navigator.bluetooth.uuids.service</code> under the name listed under "SpecificationType" with <code>org.bluetooth.service.</code> removed.

        <pre class="idl">
          [NoInterfaceObject] interface BluetoothUuidsService {
            readonly attribute UUID alert_notification;
            readonly attribute UUID battery_service;
            readonly attribute UUID blood_pressure;
            readonly attribute UUID current_time;
            readonly attribute UUID cycling_power;
            readonly attribute UUID cycling_speed_and_cadence;
            readonly attribute UUID device_information;
            readonly attribute UUID generic_access;
            readonly attribute UUID generic_attribute;
            readonly attribute UUID glucose;
            readonly attribute UUID health_thermometer;
            readonly attribute UUID heart_rate;
            readonly attribute UUID human_interface_device;
            readonly attribute UUID immediate_alert;
            readonly attribute UUID link_loss;
            readonly attribute UUID location_and_navigation;
            readonly attribute UUID next_dst_change;
            readonly attribute UUID phone_alert_status;
            readonly attribute UUID reference_time_update;
            readonly attribute UUID running_speed_and_cadence;
            readonly attribute UUID scan_parameters;
            readonly attribute UUID tx_power;
            readonly attribute UUID user_data;
          };
          enum BluetoothServiceName {
            "alert_notification",
            "battery_service",
            "blood_pressure",
            "current_time",
            "cycling_power",
            "cycling_speed_and_cadence",
            "device_information",
            "generic_access",
            "generic_attribute",
            "glucose",
            "health_thermometer",
            "heart_rate",
            "human_interface_device",
            "immediate_alert",
            "link_loss",
            "location_and_navigation",
            "next_dst_change",
            "phone_alert_status",
            "reference_time_update",
            "running_speed_and_cadence",
            "scan_parameters",
            "tx_power",
            "user_data"
          };
          typedef (BluetoothServiceName or UUID) BluetoothServiceUuid;
        </pre>

        <p>
          The <a>BluetoothServiceName</a> enumeration allows users to pass the standardized services by name instead of looking up their <a>UUID</a>s inside <code>navigator.bluetooth.uuids.service</code>.
          When used as a parameter to a function in this specification that accepts a <a>BluetoothServiceUuid</a> parameter,
          these enumeration values MUST be treated as equivalent to the <a>UUID</a> they refer to.

        <table>
          <tr><th>Member of <a>BluetoothUuidsService</a> or <a>BluetoothServiceName</a></th><th>Refers to</th></tr>
          <tr><td><dfn>alert_notification</dfn></td><td><code>canonicalUUID(0x1811)</code></td></tr>
          <tr><td><dfn>battery_service</dfn></td><td><code>canonicalUUID(0x180F)</code></td></tr>
          <tr><td><dfn>blood_pressure</dfn></td><td><code>canonicalUUID(0x1810)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsService.current_time">current_time</dfn></td><td><code>canonicalUUID(0x1805)</code></td></tr>
          <tr><td><dfn>cycling_power</dfn></td><td><code>canonicalUUID(0x1818)</code></td></tr>
          <tr><td><dfn>cycling_speed_and_cadence</dfn></td><td><code>canonicalUUID(0x1816)</code></td></tr>
          <tr><td><dfn>device_information</dfn></td><td><code>canonicalUUID(0x180A)</code></td></tr>
          <tr><td><dfn>generic_access</dfn></td><td><code>canonicalUUID(0x1800)</code></td></tr>
          <tr><td><dfn>generic_attribute</dfn></td><td><code>canonicalUUID(0x1801)</code></td></tr>
          <tr><td><dfn>glucose</dfn></td><td><code>canonicalUUID(0x1808)</code></td></tr>
          <tr><td><dfn>health_thermometer</dfn></td><td><code>canonicalUUID(0x1809)</code></td></tr>
          <tr><td><dfn>heart_rate</dfn></td><td><code>canonicalUUID(0x180D)</code></td></tr>
          <tr><td><dfn>human_interface_device</dfn></td><td><code>canonicalUUID(0x1812)</code></td></tr>
          <tr><td><dfn>immediate_alert</dfn></td><td><code>canonicalUUID(0x1802)</code></td></tr>
          <tr><td><dfn>link_loss</dfn></td><td><code>canonicalUUID(0x1803 )</code></td></tr>
          <tr><td><dfn>location_and_navigation</dfn></td><td><code>canonicalUUID(0x1819)</code></td></tr>
          <tr><td><dfn>next_dst_change</dfn></td><td><code>canonicalUUID(0x1807)</code></td></tr>
          <tr><td><dfn>phone_alert_status</dfn></td><td><code>canonicalUUID(0x180E)</code></td></tr>
          <tr><td><dfn>reference_time_update</dfn></td><td><code>canonicalUUID(0x1806)</code></td></tr>
          <tr><td><dfn>running_speed_and_cadence</dfn></td><td><code>canonicalUUID(0x1814)</code></td></tr>
          <tr><td><dfn>scan_parameters</dfn></td><td><code>canonicalUUID(0x1813)</code></td></tr>
          <tr><td><dfn>tx_power</dfn></td><td><code>canonicalUUID(0x1804)</code></td></tr>
          <tr><td><dfn>user_data</dfn></td><td><code>canonicalUUID(0x181C)</code></td></tr>
        </table>
      </section>

      <section>
        <h2>Standard GATT Characteristics</h2>

        <p>Each standardized characteristic listed in [[!BLUETOOTH-NUMBERS-CHARACTERISTICS]] MUST be reflected into <code>navigator.bluetooth.uuids.characteristic</code> under the name listed under "SpecificationType" with <code>org.bluetooth.characteristic.</code> removed.

        <pre class="idl">
          [NoInterfaceObject]
          interface BluetoothUuidsCharacteristic {
            readonly attribute UUID aerobic_heart_rate_lower_limit;
            readonly attribute UUID aerobic_heart_rate_upper_limit;
            readonly attribute UUID aerobic_threshold;
            readonly attribute UUID age;
            readonly attribute UUID alert_category_id;
            readonly attribute UUID alert_category_id_bit_mask;
            readonly attribute UUID alert_level;
            readonly attribute UUID alert_notification_control_point;
            readonly attribute UUID alert_status;
            readonly attribute UUID anaerobic_heart_rate_lower_limit;
            readonly attribute UUID anaerobic_heart_rate_upper_limit;
            readonly attribute UUID anaerobic_threshold;
            readonly attribute BluetoothUuidsCharacteristicGap gap;
            readonly attribute UUID battery_level;
            readonly attribute UUID blood_pressure_feature;
            readonly attribute UUID blood_pressure_measurement;
            readonly attribute UUID body_sensor_location;
            readonly attribute UUID boot_keyboard_input_report;
            readonly attribute UUID boot_keyboard_output_report;
            readonly attribute UUID boot_mouse_input_report;
            readonly attribute UUID csc_feature;
            readonly attribute UUID csc_measurement;
            readonly attribute UUID current_time;
            readonly attribute UUID cycling_power_control_point;
            readonly attribute UUID cycling_power_feature;
            readonly attribute UUID cycling_power_measurement;
            readonly attribute UUID cycling_power_vector;
            readonly attribute UUID database_change_increment;
            readonly attribute UUID date_of_birth;
            readonly attribute UUID date_of_threshold_assessment;
            readonly attribute UUID date_time;
            readonly attribute UUID day_date_time;
            readonly attribute UUID day_of_week;
            readonly attribute UUID dst_offset;
            readonly attribute UUID email_address;
            readonly attribute UUID exact_time_256;
            readonly attribute UUID fat_burn_heart_rate_lower_limit;
            readonly attribute UUID fat_burn_heart_rate_upper_limit;
            readonly attribute UUID firmware_revision_string;
            readonly attribute UUID first_name;
            readonly attribute UUID five_zone_heart_rate_limits;
            readonly attribute UUID gender;
            readonly attribute UUID glucose_feature;
            readonly attribute UUID glucose_measurement;
            readonly attribute UUID glucose_measurement_context;
            readonly attribute UUID hardware_revision_string;
            readonly attribute UUID heart_rate_control_point;
            readonly attribute UUID heart_rate_max;
            readonly attribute UUID heart_rate_measurement;
            readonly attribute UUID height;
            readonly attribute UUID hid_control_point;
            readonly attribute UUID hid_information;
            readonly attribute UUID hip_circumference;
            readonly attribute UUID ieee_11073_20601_regulatory_certification_data_list;
            readonly attribute UUID intermediate_blood_pressure;
            readonly attribute UUID intermediate_temperature;
            readonly attribute UUID language;
            readonly attribute UUID last_name;
            readonly attribute UUID ln_control_point;
            readonly attribute UUID ln_feature;
            readonly attribute UUID local_time_information;
            readonly attribute UUID location_and_speed;
            readonly attribute UUID manufacturer_name_string;
            readonly attribute UUID maximum_recommended_heart_rate;
            readonly attribute UUID measurement_interval;
            readonly attribute UUID model_number_string;
            readonly attribute UUID navigation;
            readonly attribute UUID new_alert;
            readonly attribute UUID pnp_id;
            readonly attribute UUID position_quality;
            readonly attribute UUID protocol_mode;
            readonly attribute UUID record_access_control_point;
            readonly attribute UUID reference_time_information;
            readonly attribute UUID report;
            readonly attribute UUID report_map;
            readonly attribute UUID resting_heart_rate;
            readonly attribute UUID ringer_control_point;
            readonly attribute UUID ringer_setting;
            readonly attribute UUID rsc_feature;
            readonly attribute UUID rsc_measurement;
            readonly attribute UUID sc_control_point;
            readonly attribute UUID scan_interval_window;
            readonly attribute UUID scan_refresh;
            readonly attribute UUID sensor_location;
            readonly attribute UUID serial_number_string;
            readonly attribute BluetoothUuidsCharacteristicGatt gatt;
            readonly attribute UUID software_revision_string;
            readonly attribute UUID sport_type_for_aerobic_and_anaerobic_thresholds;
            readonly attribute UUID supported_new_alert_category;
            readonly attribute UUID supported_unread_alert_category;
            readonly attribute UUID system_id;
            readonly attribute UUID temperature_measurement;
            readonly attribute UUID temperature_type;
            readonly attribute UUID three_zone_heart_rate_limits;
            readonly attribute UUID time_accuracy;
            readonly attribute UUID time_source;
          };
          [NoInterfaceObject]
          interface BluetoothUuidsCharacteristicGap {
            readonly attribute UUID appearance;
            readonly attribute UUID device_name;
            readonly attribute UUID peripheral_preferred_connection_parameters;
            readonly attribute UUID peripheral_privacy_flag;
            readonly attribute UUID reconnection_address;
          };
          [NoInterfaceObject]
          interface BluetoothUuidsCharacteristicGatt {
            readonly attribute UUID service_changed;
          };
          enum BluetoothCharacteristicName {
            "aerobic_heart_rate_lower_limit",
            "aerobic_heart_rate_upper_limit",
            "aerobic_threshold",
            "age",
            "alert_category_id",
            "alert_category_id_bit_mask",
            "alert_level",
            "alert_notification_control_point",
            "alert_status",
            "anaerobic_heart_rate_lower_limit",
            "anaerobic_heart_rate_upper_limit",
            "anaerobic_threshold",
            "gap.appearance",
            "battery_level",
            "blood_pressure_feature",
            "blood_pressure_measurement",
            "body_sensor_location",
            "boot_keyboard_input_report",
            "boot_keyboard_output_report",
            "boot_mouse_input_report",
            "csc_feature",
            "csc_measurement",
            "current_time",
            "cycling_power_control_point",
            "cycling_power_feature",
            "cycling_power_measurement",
            "cycling_power_vector",
            "database_change_increment",
            "date_of_birth",
            "date_of_threshold_assessment",
            "date_time",
            "day_date_time",
            "day_of_week",
            "gap.device_name",
            "dst_offset",
            "email_address",
            "exact_time_256",
            "fat_burn_heart_rate_lower_limit",
            "fat_burn_heart_rate_upper_limit",
            "firmware_revision_string",
            "first_name",
            "five_zone_heart_rate_limits",
            "gender",
            "glucose_feature",
            "glucose_measurement",
            "glucose_measurement_context",
            "hardware_revision_string",
            "heart_rate_control_point",
            "heart_rate_max",
            "heart_rate_measurement",
            "height",
            "hid_control_point",
            "hid_information",
            "hip_circumference",
            "ieee_11073_20601_regulatory_certification_data_list",
            "intermediate_blood_pressure",
            "intermediate_temperature",
            "language",
            "last_name",
            "ln_control_point",
            "ln_feature",
            "local_time_information",
            "location_and_speed",
            "manufacturer_name_string",
            "maximum_recommended_heart_rate",
            "measurement_interval",
            "model_number_string",
            "navigation",
            "new_alert",
            "gap.peripheral_preferred_connection_parameters",
            "gap.peripheral_privacy_flag",
            "pnp_id",
            "position_quality",
            "protocol_mode",
            "gap.reconnection_address",
            "record_access_control_point",
            "reference_time_information",
            "report",
            "report_map",
            "resting_heart_rate",
            "ringer_control_point",
            "ringer_setting",
            "rsc_feature",
            "rsc_measurement",
            "sc_control_point",
            "scan_interval_window",
            "scan_refresh",
            "sensor_location",
            "serial_number_string",
            "gatt.service_changed",
            "software_revision_string",
            "sport_type_for_aerobic_and_anaerobic_thresholds",
            "supported_new_alert_category",
            "supported_unread_alert_category",
            "system_id",
            "temperature_measurement",
            "temperature_type",
            "three_zone_heart_rate_limits",
            "time_accuracy",
            "time_source"
          };
          typedef (BluetoothCharacteristicName or UUID) BluetoothCharacteristicUuid;
        </pre>

        <p>
          The <a>BluetoothCharacteristicName</a> enumeration allows users to pass the standardized characteristics by name instead of looking up their <a>UUID</a>s inside <code>navigator.bluetooth.uuids.characteristic</code>.
          When used as a parameter to a function in this specification that accepts a <a>BluetoothCharacteristicUuid</a> parameter,
          these enumeration values MUST be treated as equivalent to the <a>UUID</a> they refer to.

        <table>
          <tr><th>Member of <a>BluetoothUuidsCharacteristic</a> or <a>BluetoothCharacteristicName</a></th><th>Refers to</th></tr>
          <tr><td><dfn>aerobic_heart_rate_lower_limit</dfn></td><td><code>canonicalUUID(0x2A7E)</code></td></tr>
          <tr><td><dfn>aerobic_heart_rate_upper_limit</dfn></td><td><code>canonicalUUID(0x2A84)</code></td></tr>
          <tr><td><dfn>aerobic_threshold</dfn></td><td><code>canonicalUUID(0x2A7F)</code></td></tr>
          <tr><td><dfn>age</dfn></td><td><code>canonicalUUID(0x2A80)</code></td></tr>
          <tr><td><dfn>alert_category_id</dfn></td><td><code>canonicalUUID(0x2A43)</code></td></tr>
          <tr><td><dfn>alert_category_id_bit_mask</dfn></td><td><code>canonicalUUID(0x2A42)</code></td></tr>
          <tr><td><dfn>alert_level</dfn></td><td><code>canonicalUUID(0x2A06)</code></td></tr>
          <tr><td><dfn>alert_notification_control_point</dfn></td><td><code>canonicalUUID(0x2A44)</code></td></tr>
          <tr><td><dfn>alert_status</dfn></td><td><code>canonicalUUID(0x2A3F)</code></td></tr>
          <tr><td><dfn>anaerobic_heart_rate_lower_limit</dfn></td><td><code>canonicalUUID(0x2A81)</code></td></tr>
          <tr><td><dfn>anaerobic_heart_rate_upper_limit</dfn></td><td><code>canonicalUUID(0x2A82)</code></td></tr>
          <tr><td><dfn>anaerobic_threshold</dfn></td><td><code>canonicalUUID(0x2A83)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGap.appearance">gap.appearance</dfn></td><td><code>canonicalUUID(0x2A01)</code></td></tr>
          <tr><td><dfn>battery_level</dfn></td><td><code>canonicalUUID(0x2A19)</code></td></tr>
          <tr><td><dfn>blood_pressure_feature</dfn></td><td><code>canonicalUUID(0x2A49)</code></td></tr>
          <tr><td><dfn>blood_pressure_measurement</dfn></td><td><code>canonicalUUID(0x2A35)</code></td></tr>
          <tr><td><dfn>body_sensor_location</dfn></td><td><code>canonicalUUID(0x2A38)</code></td></tr>
          <tr><td><dfn>boot_keyboard_input_report</dfn></td><td><code>canonicalUUID(0x2A22)</code></td></tr>
          <tr><td><dfn>boot_keyboard_output_report</dfn></td><td><code>canonicalUUID(0x2A32)</code></td></tr>
          <tr><td><dfn>boot_mouse_input_report</dfn></td><td><code>canonicalUUID(0x2A33)</code></td></tr>
          <tr><td><dfn>csc_feature</dfn></td><td><code>canonicalUUID(0x2A5C)</code></td></tr>
          <tr><td><dfn>csc_measurement</dfn></td><td><code>canonicalUUID(0x2A5B)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristic.current_time">current_time</dfn></td><td><code>canonicalUUID(0x2A2B)</code></td></tr>
          <tr><td><dfn>cycling_power_control_point</dfn></td><td><code>canonicalUUID(0x2A66)</code></td></tr>
          <tr><td><dfn>cycling_power_feature</dfn></td><td><code>canonicalUUID(0x2A65)</code></td></tr>
          <tr><td><dfn>cycling_power_measurement</dfn></td><td><code>canonicalUUID(0x2A63)</code></td></tr>
          <tr><td><dfn>cycling_power_vector</dfn></td><td><code>canonicalUUID(0x2A64)</code></td></tr>
          <tr><td><dfn>database_change_increment</dfn></td><td><code>canonicalUUID(0x2A99)</code></td></tr>
          <tr><td><dfn>date_of_birth</dfn></td><td><code>canonicalUUID(0x2A85)</code></td></tr>
          <tr><td><dfn>date_of_threshold_assessment</dfn></td><td><code>canonicalUUID(0x2A86)</code></td></tr>
          <tr><td><dfn>date_time</dfn></td><td><code>canonicalUUID(0x2A08)</code></td></tr>
          <tr><td><dfn>day_date_time</dfn></td><td><code>canonicalUUID(0x2A0A)</code></td></tr>
          <tr><td><dfn>day_of_week</dfn></td><td><code>canonicalUUID(0x2A09)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGap.device_name">gap.device_name</dfn></td><td><code>canonicalUUID(0x2A00)</code></td></tr>
          <tr><td><dfn>dst_offset</dfn></td><td><code>canonicalUUID(0x2A0D)</code></td></tr>
          <tr><td><dfn>email_address</dfn></td><td><code>canonicalUUID(0x2A87)</code></td></tr>
          <tr><td><dfn>exact_time_256</dfn></td><td><code>canonicalUUID(0x2A0C)</code></td></tr>
          <tr><td><dfn>fat_burn_heart_rate_lower_limit</dfn></td><td><code>canonicalUUID(0x2A88)</code></td></tr>
          <tr><td><dfn>fat_burn_heart_rate_upper_limit</dfn></td><td><code>canonicalUUID(0x2A89)</code></td></tr>
          <tr><td><dfn>firmware_revision_string</dfn></td><td><code>canonicalUUID(0x2A26)</code></td></tr>
          <tr><td><dfn>first_name</dfn></td><td><code>canonicalUUID(0x2A8A)</code></td></tr>
          <tr><td><dfn>five_zone_heart_rate_limits</dfn></td><td><code>canonicalUUID(0x2A8B)</code></td></tr>
          <tr><td><dfn>gender</dfn></td><td><code>canonicalUUID(0x2A8C)</code></td></tr>
          <tr><td><dfn>glucose_feature</dfn></td><td><code>canonicalUUID(0x2A51)</code></td></tr>
          <tr><td><dfn>glucose_measurement</dfn></td><td><code>canonicalUUID(0x2A18)</code></td></tr>
          <tr><td><dfn>glucose_measurement_context</dfn></td><td><code>canonicalUUID(0x2A34)</code></td></tr>
          <tr><td><dfn>hardware_revision_string</dfn></td><td><code>canonicalUUID(0x2A27)</code></td></tr>
          <tr><td><dfn>heart_rate_control_point</dfn></td><td><code>canonicalUUID(0x2A39)</code></td></tr>
          <tr><td><dfn>heart_rate_max</dfn></td><td><code>canonicalUUID(0x2A8D)</code></td></tr>
          <tr><td><dfn>heart_rate_measurement</dfn></td><td><code>canonicalUUID(0x2A37)</code></td></tr>
          <tr><td><dfn>height</dfn></td><td><code>canonicalUUID(0x2A8E)</code></td></tr>
          <tr><td><dfn>hid_control_point</dfn></td><td><code>canonicalUUID(0x2A4C)</code></td></tr>
          <tr><td><dfn>hid_information</dfn></td><td><code>canonicalUUID(0x2A4A)</code></td></tr>
          <tr><td><dfn>hip_circumference</dfn></td><td><code>canonicalUUID(0x2A8F)</code></td></tr>
          <tr><td><dfn>ieee_11073_20601_regulatory_certification_data_list</dfn></td><td><code>canonicalUUID(0x2A2A)</code></td></tr>
          <tr><td><dfn>intermediate_blood_pressure</dfn></td><td><code>canonicalUUID(0x2A36)</code></td></tr>
          <tr><td><dfn>intermediate_temperature</dfn></td><td><code>canonicalUUID(0x2A1E)</code></td></tr>
          <tr><td><dfn>language</dfn></td><td><code>canonicalUUID(0x2AA2)</code></td></tr>
          <tr><td><dfn>last_name</dfn></td><td><code>canonicalUUID(0x2A90)</code></td></tr>
          <tr><td><dfn>ln_control_point</dfn></td><td><code>canonicalUUID(0x2A6B)</code></td></tr>
          <tr><td><dfn>ln_feature</dfn></td><td><code>canonicalUUID(0x2A6A)</code></td></tr>
          <tr><td><dfn>local_time_information</dfn></td><td><code>canonicalUUID(0x2A0F)</code></td></tr>
          <tr><td><dfn>location_and_speed</dfn></td><td><code>canonicalUUID(0x2A67)</code></td></tr>
          <tr><td><dfn>manufacturer_name_string</dfn></td><td><code>canonicalUUID(0x2A29)</code></td></tr>
          <tr><td><dfn>maximum_recommended_heart_rate</dfn></td><td><code>canonicalUUID(0x2A91)</code></td></tr>
          <tr><td><dfn>measurement_interval</dfn></td><td><code>canonicalUUID(0x2A21)</code></td></tr>
          <tr><td><dfn>model_number_string</dfn></td><td><code>canonicalUUID(0x2A24)</code></td></tr>
          <tr><td><dfn>navigation</dfn></td><td><code>canonicalUUID(0x2A68)</code></td></tr>
          <tr><td><dfn>new_alert</dfn></td><td><code>canonicalUUID(0x2A46)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGap.peripheral_preferred_connection_parameters">gap.peripheral_preferred_connection_parameters</dfn></td><td><code>canonicalUUID(0x2A04)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGap.peripheral_privacy_flag">gap.peripheral_privacy_flag</dfn></td><td><code>canonicalUUID(0x2A02)</code></td></tr>
          <tr><td><dfn>pnp_id</dfn></td><td><code>canonicalUUID(0x2A50)</code></td></tr>
          <tr><td><dfn>position_quality</dfn></td><td><code>canonicalUUID(0x2A69)</code></td></tr>
          <tr><td><dfn>protocol_mode</dfn></td><td><code>canonicalUUID(0x2A4E)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGap.reconnection_address">gap.reconnection_address</dfn></td><td><code>canonicalUUID(0x2A03)</code></td></tr>
          <tr><td><dfn>record_access_control_point</dfn></td><td><code>canonicalUUID(0x2A52)</code></td></tr>
          <tr><td><dfn>reference_time_information</dfn></td><td><code>canonicalUUID(0x2A14)</code></td></tr>
          <tr><td><dfn>report</dfn></td><td><code>canonicalUUID(0x2A4D)</code></td></tr>
          <tr><td><dfn>report_map</dfn></td><td><code>canonicalUUID(0x2A4B)</code></td></tr>
          <tr><td><dfn>resting_heart_rate</dfn></td><td><code>canonicalUUID(0x2A92)</code></td></tr>
          <tr><td><dfn>ringer_control_point</dfn></td><td><code>canonicalUUID(0x2A40)</code></td></tr>
          <tr><td><dfn>ringer_setting</dfn></td><td><code>canonicalUUID(0x2A41)</code></td></tr>
          <tr><td><dfn>rsc_feature</dfn></td><td><code>canonicalUUID(0x2A54)</code></td></tr>
          <tr><td><dfn>rsc_measurement</dfn></td><td><code>canonicalUUID(0x2A53)</code></td></tr>
          <tr><td><dfn>sc_control_point</dfn></td><td><code>canonicalUUID(0x2A55)</code></td></tr>
          <tr><td><dfn>scan_interval_window</dfn></td><td><code>canonicalUUID(0x2A4F)</code></td></tr>
          <tr><td><dfn>scan_refresh</dfn></td><td><code>canonicalUUID(0x2A31)</code></td></tr>
          <tr><td><dfn>sensor_location</dfn></td><td><code>canonicalUUID(0x2A5D)</code></td></tr>
          <tr><td><dfn>serial_number_string</dfn></td><td><code>canonicalUUID(0x2A25)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsCharacteristicGatt.service_changed">gatt.service_changed</dfn></td><td><code>canonicalUUID(0x2A05)</code></td></tr>
          <tr><td><dfn>software_revision_string</dfn></td><td><code>canonicalUUID(0x2A28)</code></td></tr>
          <tr><td><dfn>sport_type_for_aerobic_and_anaerobic_thresholds</dfn></td><td><code>canonicalUUID(0x2A93)</code></td></tr>
          <tr><td><dfn>supported_new_alert_category</dfn></td><td><code>canonicalUUID(0x2A47)</code></td></tr>
          <tr><td><dfn>supported_unread_alert_category</dfn></td><td><code>canonicalUUID(0x2A48)</code></td></tr>
          <tr><td><dfn>system_id</dfn></td><td><code>canonicalUUID(0x2A23)</code></td></tr>
          <tr><td><dfn>temperature_measurement</dfn></td><td><code>canonicalUUID(0x2A1C)</code></td></tr>
          <tr><td><dfn>temperature_type</dfn></td><td><code>canonicalUUID(0x2A1D)</code></td></tr>
          <tr><td><dfn>three_zone_heart_rate_limits</dfn></td><td><code>canonicalUUID(0x2A94)</code></td></tr>
          <tr><td><dfn>time_accuracy</dfn></td><td><code>canonicalUUID(0x2A12)</code></td></tr>
          <tr><td><dfn>time_source</dfn></td><td><code>canonicalUUID(0x2A13)</code></td></tr>
        </table>
      </section>

      <section>
        <h2>Standard GATT Descriptors</h2>

        <p>Each standardized descriptor listed in [[!BLUETOOTH-NUMBERS-DESCRIPTORS]] MUST be reflected into <code>navigator.bluetooth.uuids.descriptor</code> under the name listed under "SpecificationType" with <code>org.bluetooth.descriptor.</code> removed.

        <pre class="idl">
          [NoInterfaceObject]
          interface BluetoothUuidsDescriptor {
            readonly attribute BluetoothUuidsDescriptorGatt gatt;
            readonly attribute UUID valid_range;
            readonly attribute UUID external_report_reference;
            readonly attribute UUID report_reference;
          };
          [NoInterfaceObject]
          interface BluetoothUuidsDescriptorGatt {
            readonly attribute UUID characteristic_extended_properties;
            readonly attribute UUID characteristic_user_description;
            readonly attribute UUID client_characteristic_configuration;
            readonly attribute UUID server_characteristic_configuration;
            readonly attribute UUID characteristic_presentation_format;
            readonly attribute UUID characteristic_aggregate_format;
          };
          enum BluetoothDescriptorName {
            "gatt.characteristic_extended_properties",
            "gatt.characteristic_user_description",
            "gatt.client_characteristic_configuration",
            "gatt.server_characteristic_configuration",
            "gatt.characteristic_presentation_format",
            "gatt.characteristic_aggregate_format",
            "valid_range",
            "external_report_reference",
            "report_reference"
          };
          typedef (BluetoothDescriptorName or UUID) BluetoothDescriptorUuid;
        </pre>

        <p>
          The <a>BluetoothDescriptorName</a> enumeration allows users to pass the standardized descriptors by name instead of looking up their <a>UUID</a>s inside <code>navigator.bluetooth.uuids.descriptor</code>.
          When used as a parameter to a function in this specification that accepts a <a>BluetoothDescriptorUuid</a> parameter,
          these enumeration values MUST be treated as equivalent to the <a>UUID</a> they refer to.

        <table>
          <tr><th>Member of <a>BluetoothUuidsDescriptor</a> or <a>BluetoothDescriptorName</a></th><th>Refers to</th></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.characteristic_extended_properties">gatt.characteristic_extended_properties</dfn></td><td><code>canonicalUUID(0x2900)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.characteristic_user_description">gatt.characteristic_user_description</dfn></td><td><code>canonicalUUID(0x2901)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.client_characteristic_configuration">gatt.client_characteristic_configuration</dfn></td><td><code>canonicalUUID(0x2902)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.server_characteristic_configuration">gatt.server_characteristic_configuration</dfn></td><td><code>canonicalUUID(0x2903)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.characteristic_presentation_format">gatt.characteristic_presentation_format</dfn></td><td><code>canonicalUUID(0x2904)</code></td></tr>
          <tr><td><dfn title="BluetoothUuidsDescriptorGatt.characteristic_aggregate_format">gatt.characteristic_aggregate_format</dfn></td><td><code>canonicalUUID(0x2905)</code></td></tr>
          <tr><td><dfn>valid_range</dfn></td><td><code>canonicalUUID(0x2906)</code></td></tr>
          <tr><td><dfn>external_report_reference</dfn></td><td><code>canonicalUUID(0x2907)</code></td></tr>
          <tr><td><dfn>report_reference</dfn></td><td><code>canonicalUUID(0x2908)</code></td></tr>
        </table>
      </section>
    </section>

    <section>
      <h2>Interface Wiring</h2>

      <pre class="idl">
        Navigator implements NavigatorBluetooth;

        [NoInterfaceObject]
        interface NavigatorBluetooth {
          readonly attribute Bluetooth bluetooth;
        };
        [NoInterfaceObject] interface Bluetooth {};
        Bluetooth implements BluetoothDiscovery;
        Bluetooth implements BluetoothInteraction;
      </pre>
    </section>
  </body>
</html>
